<table id="payment_<%= payment.payment_id %>" class="table table-condensed table-striped">
  <thead>
  <tr>
    <th>Date</th>
    <th>Type</th>
    <th>Amount</th>
    <th>First id</th>
    <th>Second id</th>
    <th>Gateway code</th>
    <th>Gateway message</th>
    <th>Status</th>
  </tr>
  </thead>
  <tbody>
  <% (payment.transactions || []).each do |transaction| %>
      <tr>
        <td><%= format_date(transaction.effective_date, account.time_zone).html_safe %></td>
        <td><%= transaction.transaction_type %></td>
        <td>
          <% if transaction.amount.present? %>
              <%= humanized_money_with_symbol Kaui::Transaction.amount_to_money(transaction) %>
              (<%= transaction.currency %>)
          <% end %>
        </td>
        <td><%= transaction.first_payment_reference_id %></td>
        <td><%= transaction.second_payment_reference_id %></td>
        <td><%= transaction.gateway_error_code %></td>
        <td><%= transaction.gateway_error_msg %></td>
        <td>
          <span
          <% if transaction.status != 'SUCCESS' %>class='alert-danger'
          <% else %>class='alert-success' <% end %>>
          <%= transaction.status %>
          </span>
        </td>
      </tr>
  <% end %>
  </tbody>
</table>

<%= javascript_tag do %>
    $(document).ready(function() {
    $('#payment_<%= payment.payment_id %>').dataTable({
    "dom": "t",
    "paginate": false
    });
    });
<% end %>

<h4>Actions</h4>
<ul>
  <% if payment.refundable? %>
      <% if can? :refund, Kaui::Payment %>
          <% if payment.target_invoice_id.present? %>
              <li>
                <%= link_to 'Refund', kaui_engine.new_refund_path(:params => {:payment_id => payment.payment_id,
                                                                              :account_id => payment.account_id,
                                                                              :invoice_id => payment.target_invoice_id}) %>
              </li>
          <% else %>
              <li>
                <%= link_to 'Refund', kaui_engine.new_account_transaction_path(payment.account_id,
                                                                               :payment_id => payment.payment_id,
                                                                               :payment_method_id => payment.payment_method_id,
                                                                               :amount => payment.amount_refundable,
                                                                               :currency => payment.currency,
                                                                               :transaction_type => 'REFUND'), :class => 'btn btn-xs' %>
              </li>
          <% end %>
      <% end %>
      <% if can? :chargeback, Kaui::Payment %>
          <% if payment.target_invoice_id.present? %>
              <li>
                <%= link_to 'Chargeback', kaui_engine.new_chargeback_path(:params => {:payment_id => payment.payment_id,
                                                                                      :account_id => payment.account_id,
                                                                                      :invoice_id => payment.target_invoice_id}) %>
              </li>
          <% else %>
              <li>
                <%= link_to 'Chargeback', kaui_engine.new_account_transaction_path(payment.account_id,
                                                                                   :payment_id => payment.payment_id,
                                                                                   :payment_method_id => payment.payment_method_id,
                                                                                   :amount => payment.amount_refundable,
                                                                                   :currency => payment.currency,
                                                                                   :transaction_type => 'CHARGEBACK'), :class => 'btn btn-xs' %>
              </li>
          <% end %>
      <% end %>
  <% end %>
  <% if payment.capturable? %>
      <li>
        <%= link_to 'Capture', kaui_engine.new_account_transaction_path(payment.account_id,
                                                                        :payment_id => payment.payment_id,
                                                                        :payment_method_id => payment.payment_method_id,
                                                                        :amount => payment.amount_capturable,
                                                                        :currency => payment.currency,
                                                                        :transaction_type => 'CAPTURE'), :class => 'btn btn-xs' %>
      </li>
  <% end %>
  <% if payment.voidable? %>
      <li>
        <%= link_to 'Void', kaui_engine.new_account_transaction_path(payment.account_id,
                                                                     :payment_id => payment.payment_id,
                                                                     :payment_method_id => payment.payment_method_id,
                                                                     :transaction_type => 'VOID'), :class => 'btn btn-xs' %>
      </li>
  <% end %>
</ul>
