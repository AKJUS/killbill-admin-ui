<div class="column-block">
  <h1>Account Information</h1>

  <div class="account-info">
    <div class="row">
      <div class="col-md-5 fix-position">
        <table class="transparent">
          <tr>
            <th>Name:</th>
            <td><%= @account.name %></td>
          </tr>
          <tr>
            <th>ID:</th>
            <td><%= @account.account_id %></td>
          </tr>
          <tr>
            <th>External key:</th>
            <td><%= @account.external_key %></td>
          </tr>
          <tr>
            <th>Currency:</th>
            <td><%= @account.currency %></td>
          </tr>
          <tr>
            <th>Timezone:</th>
            <td><%= @account.time_zone %></td>
          </tr>
          </table>
        </div>
      <div class="col-md-5 col-md-offset-1">
        <table class="transparent">
          <tr>
            <th>Email:</th>
            <td><%= @account.email %></td>
          </tr>
          <tr>
            <th>Address 1:</th>
            <td><%= @account.address1 %></td>
          </tr>
          <tr>
            <th>Address 2:</th>
            <td><%= @account.address2 %></td>
          </tr>
          <tr>
            <th>City:</th>
            <td><%= @account.city %></td>
          </tr>
          <tr>
            <th>State:</th>
            <td><%= @account.state %></td>
          </tr>
          <tr>
            <th>Country:</th>
            <td><%= @account.country %></td>
          </tr>
          <tr>
            <th>Postal code:</th>
            <td><%= @account.postal_code %></td>
          </tr>
          <tr>
            <th>Phone:</th>
            <td><%= @account.phone %></td>
          </tr>
          <tr>
            <th>Company:</th>
            <td><%= @account.company %></td>
          </tr>
          <%= render :partial => 'kaui/account_emails/account_emails_table',
                     :locals => {:account_emails => @account_emails} %>
        </table>
      </div>
    </div>
  </div>
</div>

<%= link_to 'Edit',
            kaui_engine.edit_account_path(@account.account_id),
            :class => 'btn btn-xs' %>

<%= render :partial => 'kaui/tags/tags_table',
           :locals => {:tags => @tags, :tags_url_or_path => kaui_engine.edit_account_tags_path(@account.account_id)} %>

<h3>Billing Information</h3>

<!-- Payment, Credit then Charge. Same ordering as in the billing timeline -->
<%= link_to 'Pay all invoices',
            kaui_engine.pay_all_invoices_account_path(@account.account_id),
            :method => :post,
            :class => 'btn btn-xs' %>
<% if can? :credit, Kaui::Account %>
    <%= link_to 'Add credit',
                kaui_engine.new_account_credit_path(@account.account_id, :currency => @account.currency),
                :class => 'btn btn-xs' %>
<% end %>
<% if can? :charge, Kaui::Account %>
    <%= link_to 'Create charge',
                kaui_engine.new_account_charge_path(@account.account_id, :currency => @account.currency),
                :class => 'btn btn-xs' %>
<% end %>

<dl class="dl-horizontal">
  <dt>Account balance:</dt>
  <% if @account.account_balance.nil? %>
      <dd>unknown</dd>
  <% elsif @account.account_balance <= 0 %>
      <dd><span class="label label-success"><%= humanized_money_with_symbol @account.balance_to_money %>
        (<%= @account.currency %>)</span></dd>
  <% else %>
      <dd><span class="label label-danger"><%= humanized_money_with_symbol @account.balance_to_money %>
        (<%= @account.currency %>)</span></dd>
  <% end %>
  <dt>Account credit:</dt>
  <% if @account.account_cba.nil? %>
      <dd>unknown</dd>
  <% elsif @account.account_cba >= 0 %>
      <dd><span class="label label-success"><%= humanized_money_with_symbol @account.cba_to_money %>
        (<%= @account.currency %>)</span></dd>
  <% else %>
      <dd><span class="label label-danger"><%= humanized_money_with_symbol @account.cba_to_money %>
        (<%= @account.currency %>)</span></dd>
  <% end %>
  <dt>Next invoice date:</dt>
  <% if @next_invoice_date %>
      <dd><%= @next_invoice_date %> (user timezone)</dd>
  <% else %>
      <dd>N/A</dd>
  <% end %>
  <dt>Bill cycle day:</dt>
  <% if @account.bill_cycle_day_local %>
      <dd><%= @account.bill_cycle_day_local %> (user timezone)</dd>
  <% else %>
      <dd><%= t :unknown_bcd %></dd>
  <% end %>
  <dt>Overdue status:</dt>
  <% if @overdue_state.nil? %>
      <dd>unknown</dd>
  <% elsif @overdue_state.clear_state %>
      <dd><span class='label label-success'>Good</span>
      <dd>
  <% else %>
      <dd><span class='label label-danger'><%= @overdue_state.name %></span>
      <dd>
  <% end %>
  <dt>Notified for inv?</dt>
  <dd><%= @account.is_notified_for_invoices %>&nbsp;<%= link_to 'Toggle', kaui_engine.toggle_email_notifications_account_path(@account.account_id, :is_notified => !@account.is_notified_for_invoices), :method => :post, :class => 'btn btn-xs' %></dd>
</dl>

<% if @payment_methods.present? %>
    <%= render :partial => 'kaui/payment_methods/payment_methods_table', :locals => {:account => @account, :payment_methods => @payment_methods} %>
<% end %>
<%= link_to 'Add payment method', kaui_engine.new_payment_method_path(:account_id => @account.account_id), :class => 'btn btn-xs' %>

<%= javascript_tag do %>
  function disableLinks() {
    $('a.btn.disabled').click(function (e) {
      // e.preventDefault(); is not enough here
      return false;
    });
  }

  $(document).ready(function() {
    disableLinks();
  });
<% end %>
